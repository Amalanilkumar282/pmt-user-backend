# Sprint Planning API Combined Documentation

This document provides detailed information for the following APIs, which are essential for implementing the Sprint Planning feature in the frontend:

- **GET /api/Team/project/{projectId}**
- **POST /api/sprints**
- **POST /api/sprints/projects/{projectId}/ai-plan**

Each section includes request/response formats, required fields, and error handling details.

---

## 1. GET /api/Team/project/{projectId}

### Purpose

Fetches all teams associated with a given project. Used to display team selection options when planning a sprint.

### Request

- **Method:** GET
- **URL:** `/api/Team/project/{projectId}`
- **Path Parameter:**
  - `projectId` (GUID, required): The unique identifier of the project.
- **Headers:**
  - `Authorization: Bearer <token>` (required)

### Response

- **Status 200 OK**

```json
{
  "succeeded": true,
  "statusCode": 200,
  "data": [
    {
      "id": "team-guid",
      "name": "Team Alpha",
      "members": [
        {
          "id": "user-guid",
          "name": "Jane Doe",
          "email": "jane@example.com",
          "role": "Developer"
        }
      ]
    }
    // ... more teams
  ]
}
```

### Error Responses

- **401 Unauthorized**: Missing or invalid token
- **404 Not Found**: Project not found
- **500 Internal Server Error**: Unexpected server error

**Error Format:**

```json
{
  "succeeded": false,
  "statusCode": <error_code>,
  "message": "<error_message>"
}
```

---

## 2. POST /api/sprints

### Purpose

Creates a new sprint for a project team. Used after planning is complete to persist the sprint. The sprint ID is **auto-generated** by the server and returned in the response.

### Request

- **Method:** POST
- **URL:** `/api/sprints`
- **Headers:**
  - `Authorization: Bearer <token>` (required)
  - `Content-Type: application/json`
- **Body:**

```json
{
  "sprintName": "Sprint 15",
  "sprintGoal": "Implement user authentication",
  "startDate": "2025-02-01",
  "endDate": "2025-02-14",
  "targetStoryPoints": 40,
  "teamId": "team-guid",
  "projectId": "project-guid"
}
```

**Note:** Do not include `id` in the request body. It will be auto-generated by the server.

### Response

- **Status 201 Created**

```json
{
  "succeeded": true,
  "statusCode": 201,
  "data": {
    "id": "auto-generated-sprint-guid",
    "sprintName": "Sprint 15",
    "status": "Planned",
    "startDate": "2025-02-01",
    "endDate": "2025-02-14",
    "targetStoryPoints": 40,
    "teamId": "team-guid",
    "projectId": "project-guid"
  }
}
```

### Error Responses

- **400 Bad Request**: Missing or invalid fields (e.g., dates, teamId, projectId)
- **401 Unauthorized**: Missing or invalid token
- **404 Not Found**: Team or project not found
- **409 Conflict**: Sprint overlaps with existing sprint
- **500 Internal Server Error**: Unexpected server error

**Error Format:**

```json
{
  "succeeded": false,
  "statusCode": <error_code>,
  "message": "<error_message>"
}
```

---

## 3. POST /api/sprints/projects/{projectId}/ai-plan

### Purpose

Generates an AI-powered sprint plan for a project using Google Gemini. Returns recommended issues, capacity analysis, and planning recommendations.

### Request

- **Method:** POST
- **URL:** `/api/sprints/projects/{projectId}/ai-plan`
- **Path Parameter:**
  - `projectId` (GUID, required): The unique identifier of the project.
- **Headers:**
  - `Authorization: Bearer <token>` (required)
  - `Content-Type: application/json`
- **Body:**

```json
{
  "sprintName": "Sprint 15",
  "sprintGoal": "Implement user authentication",
  "startDate": "2025-02-01",
  "endDate": "2025-02-14",
  "targetStoryPoints": 40,
  "teamId": "team-guid"
}
```

### Response

- **Status 200 OK**

```json
{
  "succeeded": true,
  "statusCode": 200,
  "data": {
    "sprintPlan": {
      "selectedIssues": [
        {
          "issueId": "uuid",
          "issueKey": "PHX-201",
          "storyPoints": 8,
          "suggestedAssigneeId": 5,
          "rationale": "CRITICAL priority authentication feature"
        }
        // ... 2-9 more issues
      ],
      "totalStoryPoints": 38,
      "summary": "Sprint plan focuses on critical authentication...",
      "recommendations": [
        {
          "type": "priority",
          "severity": "info",
          "message": "Sprint includes 2 critical issues..."
        }
      ],
      "capacityAnalysis": {
        "teamCapacityUtilization": 95,
        "estimatedCompletionProbability": 85,
        "riskFactors": []
      }
    }
  }
}
```

### Error Responses

- **400 Bad Request**: Missing or invalid fields (e.g., teamId, targetStoryPoints)
- **401 Unauthorized**: Missing or invalid token
- **404 Not Found**: Project or team not found
- **429 Too Many Requests**: Gemini API rate limit exceeded
- **500 Internal Server Error**: Unexpected server error or Gemini API failure

**Error Format:**

```json
{
  "succeeded": false,
  "statusCode": <error_code>,
  "message": "<error_message>"
}
```

---

## General Error Handling

All APIs return errors in a consistent format. Always check for `succeeded: false` and handle the `message` field for user feedback.

**Example Error Response:**

```json
{
  "succeeded": false,
  "statusCode": 400,
  "message": "TeamId is required."
}
```

## Usage Notes

- All endpoints require a valid JWT Bearer token.
- Dates must be in ISO 8601 format (YYYY-MM-DD).
- For AI planning, ensure the team and backlog are properly set up in the project.
- Error messages are user-friendly and suitable for frontend display.

---

---

## 4. POST /api/Issue

### Purpose

Creates a new issue (task, bug, story, etc.) in the project backlog. Used to add items for sprint planning and tracking.

### Request

- **Method:** POST
- **URL:** `/api/Issue`
- **Headers:**
  - `Authorization: Bearer <token>` (required)
  - `Content-Type: application/json`
- **Body:**

```json
{
  "title": "Implement login page",
  "description": "Create a secure login page for users.",
  "issueType": "Story", // e.g., Story, Bug, Task
  "priority": "HIGH", // e.g., CRITICAL, HIGH, MEDIUM, LOW
  "storyPoints": 5,
  "assigneeId": "user-guid", // optional
  "projectId": "project-guid",
  "labels": ["frontend", "auth"] // optional
}
```

### Response

- **Status 201 Created**

```json
{
  "succeeded": true,
  "statusCode": 201,
  "data": {
    "id": "issue-guid",
    "title": "Implement login page",
    "issueType": "Story",
    "priority": "HIGH",
    "storyPoints": 5,
    "status": "Backlog",
    "assigneeId": "user-guid",
    "projectId": "project-guid",
    "labels": ["frontend", "auth"]
  }
}
```

### Error Responses

- **400 Bad Request**: Missing or invalid fields (e.g., title, projectId)
- **401 Unauthorized**: Missing or invalid token
- **404 Not Found**: Project or assignee not found
- **409 Conflict**: Duplicate issue title in project
- **500 Internal Server Error**: Unexpected server error

**Error Format:**

```json
{
  "succeeded": false,
  "statusCode": <error_code>,
  "message": "<error_message>"
}
```

---

**Last Updated:** November 1, 2025
